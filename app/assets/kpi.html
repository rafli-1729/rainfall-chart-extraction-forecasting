<style>
* {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI",
                 Roboto, Helvetica, Arial, sans-serif;
    box-sizing: border-box;
}

.kpi-wrapper {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 25px;
    margin-bottom: 1px;
    align-items: start;
}

.kpi-card {
    background: #f8fafc;
    border-radius: 16px;
    padding: 20px 18px;
    text-align: center;
    margin-left: -0.5rem;
    margin-right: -0.5rem;
}

.kpi-label {
    font-size: 0.8rem;
    font-weight: 500;
    color: #64748b;
    margin-bottom: 6px;
}

.kpi-value {
    font-size: 2rem;
    font-weight: 600;
    color: #0f172a;
    margin-bottom: 4px;
    letter-spacing: -0.02em;
}

.kpi-unit {
    font-size: 0.75rem;
    color: #94a3b8;
}

.kpi-sub {
    font-size: 0.75rem;
    color: #94a3b8;
    margin-top: 2px;
}

.kpi-note {
    margin-top: 8px;
    font-size: 0.85rem;
    color: #475569;
    line-height: 1.4;
}

.kpi-callout {
    margin-top: 12px;
    padding-top: 10px;
    border-top: 1px dashed rgba(15, 23, 42, 0.15);
    font-size: 0.8rem;
    color: #475569;
    text-align: center;
}

.kpi-callout-label {
    font-weight: 600;
    color: #334155;
}
</style>

<p style="font-size:0.85rem;color:#64748b;margin-bottom:12px;">
Model performance metrics comparing predicted rainfall values
against rainfall extracted from historical charts.
</p>

<div class="kpi-wrapper">
    <div class="kpi-card">
        <div class="kpi-label">Locations Evaluated</div>
        <div class="kpi-value" data-target="{{ locations_covered }}">0</div>
        <div class="kpi-sub">Rainfall stations included</div>

        <div class="kpi-note">
            Model performance is evaluated across multiple monitoring locations.
        </div>
    </div>

    <div class="kpi-card">
        <div class="kpi-label">Evaluation Samples</div>
        <div class="kpi-value" data-target="{{ evaluation_records }}">0</div>
        <div class="kpi-sub">Daily observations</div>

        <div class="kpi-note">
            Each record represents a daily rainfall value extracted from charts.
        </div>
    </div>

    <div class="kpi-card">
        <div class="kpi-label">Average Prediction Error</div>
        <div class="kpi-value" data-target="{{ mae }}">0</div>
        <div class="kpi-unit">mm</div>

        <div class="kpi-note">
            On average, model predictions differ from extracted rainfall values
            by this amount.
        </div>

        <div class="kpi-callout">
            <span class="kpi-callout-label">Metric:</span> Mean Absolute Error
        </div>
    </div>

    <div class="kpi-card">
        <div class="kpi-label">Error on Extreme Days</div>
        <div class="kpi-value" data-target="{{ rmse }}">0</div>
        <div class="kpi-unit">mm</div>

        <div class="kpi-note">
            Larger errors tend to occur during high-rainfall events,
            which are penalized more heavily.
        </div>

        <div class="kpi-callout">
            <span class="kpi-callout-label">Metric:</span> Root Mean Squared Error
        </div>
    </div>
</div>

<script>
document.querySelectorAll('.kpi-value[data-target]').forEach(el => {
    const target = Number(el.dataset.target);
    let current = 0;
    const step = Math.max(0.5, target / 40);

    function tick() {
        current += step;
        if (current >= target) {
            el.textContent = target.toFixed(2).replace(/\.00$/, "");
        } else {
            el.textContent = current.toFixed(1);
            requestAnimationFrame(tick);
        }
    }
    tick();
});
</script>
